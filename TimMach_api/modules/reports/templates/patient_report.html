<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Hồ sơ bệnh nhân</title>
  <style>
    body { font-family: Arial, sans-serif; color: #1f2937; margin: 20px; }
    h1, h2, h3 { margin: 0 0 8px 0; }
    .section { margin-bottom: 16px; padding: 12px; border: 1px solid #e5e7eb; border-radius: 6px; }
    table { width: 100%; border-collapse: collapse; margin-top: 8px; font-size: 14px; }
    th, td { border: 1px solid #e5e7eb; padding: 6px 8px; text-align: left; }
    th { background: #f3f4f6; }
    .footer { margin-top: 16px; font-size: 12px; color: #6b7280; }
  </style>
</head>
<body>
  <h1>{{.ClinicName}}</h1>
  <p>Thời gian in: {{.GeneratedAt}}</p>

  <div class="section">
    <h2>1. Thông tin bệnh nhân</h2>
    <p><strong>Họ tên:</strong> {{.Patient.Name}}</p>
    <p><strong>Ngày sinh:</strong> {{.Patient.DOB}} &nbsp;&nbsp; <strong>Giới tính:</strong> {{.Patient.Gender}}</p>
    <p><strong>Tuổi:</strong> {{.Patient.AgeYears}} &nbsp;&nbsp; <strong>Chiều cao:</strong> {{printf "%.1f" .Patient.HeightCm}} cm &nbsp;&nbsp; <strong>Cân nặng:</strong> {{printf "%.1f" .Patient.WeightKg}} kg</p>
    <p><strong>BMI:</strong> {{printf "%.1f" .Patient.BMI}}</p>
  </div>

  <div class="section">
    <h2>2. Dự đoán nguy cơ gần nhất</h2>
    {{if .LatestPrediction}}
      <p><strong>Thời gian:</strong> {{.LatestPrediction.Time}}</p>
      <p><strong>Nguy cơ ước tính:</strong> {{.LatestPrediction.ProbabilityPct}}% ({{.LatestPrediction.Label}})</p>
      <p><strong>Các yếu tố nguy cơ chính:</strong>
        {{if .LatestPrediction.MainRiskFactors}}
          {{range .LatestPrediction.MainRiskFactors}}<span>{{.}}</span>{{end}}
        {{else}}
          Không xác định
        {{end}}
      </p>
    {{else}}
      <p>Chưa có kết quả dự đoán.</p>
    {{end}}
  </div>

  <div class="section">
    <h2>3. Kế hoạch tập luyện</h2>
    <p>{{.ExercisePlan.Summary}}</p>
    {{if .ExercisePlan.Sessions}}
      <table>
        <thead>
          <tr>
            <th>Bài tập</th>
            <th>Thời lượng (phút)</th>
            <th>Tần suất</th>
            <th>Ghi chú</th>
          </tr>
        </thead>
        <tbody>
          {{range .ExercisePlan.Sessions}}
          <tr>
            <td>{{.Name}}</td>
            <td>{{.DurationMin}}</td>
            <td>{{.Frequency}}</td>
            <td>{{.Notes}}</td>
          </tr>
          {{end}}
        </tbody>
      </table>
    {{else}}
      <p>Chưa có gợi ý tập luyện.</p>
    {{end}}
  </div>

  <div class="section">
    <h2>4. Lịch sử đánh giá nguy cơ</h2>
    {{if .History}}
      <table>
        <thead>
          <tr>
            <th>Thời gian</th>
            <th>Nguy cơ (%)</th>
            <th>Nhóm</th>
          </tr>
        </thead>
        <tbody>
          {{range .History}}
          <tr>
            <td>{{.Time}}</td>
            <td>{{.ProbabilityPct}}</td>
            <td>{{.RiskLabel}}</td>
          </tr>
          {{end}}
        </tbody>
      </table>
    {{else}}
      <p>Chưa có lịch sử dự đoán.</p>
    {{end}}
  </div>

  <div class="footer">
    Tài liệu này chỉ mang tính chất hỗ trợ chuyên môn, không thay thế tư vấn hoặc chỉ định của bác sĩ điều trị.
  </div>
</body>
</html>
